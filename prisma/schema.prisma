// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

// NextAuth.js models
model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified DateTime?
  image         String?
  password      String?
  role          UserRole  @default(STUDENT)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  accounts          Account[]
  sessions          Session[]
  dailyCheckIns     DailyCheckIn[]
  academicData      AcademicData[]
  burnoutScores     BurnoutScore[]
  recommendations   Recommendation[]
  counselorSessions CounselorSession[]
  interventions     Intervention[]
  privacySettings   PrivacySettings?
  assignments       Assignment[]
  wellnessStreak    WellnessStreak?
  achievements      Achievement[]
  wellnessActivities WellnessActivity[]
  moodInsight       MoodInsight?
  studySessions     StudySession[]
  aiConversations   AIConversation[]
  emergencyContacts EmergencyContact[]
  sosAlerts         SOSAlert[]
  predictiveAlerts  PredictiveAlert[]
}

model Account {
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([provider, providerAccountId])
}

model Session {
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model VerificationToken {
  identifier String
  token      String
  expires    DateTime

  @@id([identifier, token])
}

// Core app models
model DailyCheckIn {
  id          String   @id @default(cuid())
  userId      String
  date        DateTime @default(now())
  mood        Int      // 1-10 scale
  sleepHours  Float
  stressLevel Int      // 1-10 scale
  energyLevel Int      // 1-10 scale
  notes       String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
}

model AcademicData {
  id                 String   @id @default(cuid())
  userId             String
  date               DateTime @default(now())
  attendancePercent  Float
  assignmentsSubmitted Int
  totalAssignments   Int
  averageGrade       Float?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Assignment {
  id          String   @id @default(cuid())
  userId      String
  title       String
  description String?
  dueDate     DateTime
  priority    Priority @default(MEDIUM)
  completed   Boolean  @default(false)
  createdAt   DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model BurnoutScore {
  id                String   @id @default(cuid())
  userId            String
  date              DateTime @default(now())
  score             Float    // 0-100
  sleepDeficit      Float
  stressTrend       Float
  deadlineDensity   Float
  attendanceDrop    Float
  activityChange    Float
  riskLevel         RiskLevel

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Recommendation {
  id          String            @id @default(cuid())
  userId      String
  type        RecommendationType
  title       String
  description String
  createdAt   DateTime          @default(now())
  completed   Boolean           @default(false)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model CounselorSession {
  id          String        @id @default(cuid())
  userId      String
  sessionType SessionType
  date        DateTime
  time        String
  anonymous   Boolean       @default(false)
  status      BookingStatus @default(PENDING)
  notes       String?
  createdAt   DateTime      @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Intervention {
  id          String   @id @default(cuid())
  userId      String
  mentorId    String
  type        String
  description String
  createdAt   DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model PrivacySettings {
  id                    String  @id @default(cuid())
  userId                String  @unique
  shareWithMentors      Boolean @default(true)
  shareAcademicData     Boolean @default(true)
  shareWellnessData     Boolean @default(false)
  emailNotifications    Boolean @default(true)
  pushNotifications     Boolean @default(true)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model WellnessStreak {
  id            String   @id @default(cuid())
  userId        String   @unique
  currentStreak Int      @default(0)
  longestStreak Int      @default(0)
  lastCheckIn   DateTime?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Achievement {
  id          String          @id @default(cuid())
  userId      String
  type        AchievementType
  title       String
  description String
  earnedAt    DateTime        @default(now())
  icon        String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model WellnessActivity {
  id          String       @id @default(cuid())
  userId      String
  type        ActivityType
  duration    Int          // in seconds
  completed   Boolean      @default(false)
  createdAt   DateTime     @default(now())
  completedAt DateTime?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model MoodInsight {
  id              String   @id @default(cuid())
  userId          String   @unique
  avgMood         Float
  avgSleep        Float
  avgStress       Float
  avgEnergy       Float
  moodTrend       String   // IMPROVING, DECLINING, STABLE
  topStressor     String?
  bestDayOfWeek   String?
  worstDayOfWeek  String?
  updatedAt       DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model StudySession {
  id          String   @id @default(cuid())
  userId      String
  duration    Int      // in seconds
  breaks      Int      @default(0)
  completed   Boolean  @default(false)
  focusScore  Int?     // 0-100
  subject     String?
  createdAt   DateTime @default(now())
  endedAt     DateTime?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model AIConversation {
  id          String   @id @default(cuid())
  userId      String
  messages    String   // JSON array of messages
  topic       String?  // WELLNESS, ACADEMIC, CRISIS, etc
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model EmergencyContact {
  id            String   @id @default(cuid())
  userId        String
  name          String
  relationship  String
  phone         String
  email         String?
  isPrimary     Boolean  @default(false)
  createdAt     DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model SOSAlert {
  id          String      @id @default(cuid())
  userId      String
  status      SOSStatus   @default(ACTIVE)
  message     String?
  location    String?
  createdAt   DateTime    @default(now())
  resolvedAt  DateTime?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model PredictiveAlert {
  id              String   @id @default(cuid())
  userId          String
  alertType       String   // BURNOUT_WARNING, SLEEP_CRISIS, STRESS_SPIKE
  severity        String   // LOW, MEDIUM, HIGH, CRITICAL
  prediction      String   // What will happen
  recommendation  String   // What to do
  daysAhead       Int      // How many days in advance
  dismissed       Boolean  @default(false)
  createdAt       DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// Enums
enum UserRole {
  STUDENT
  MENTOR
  ADMIN
  COUNSELOR
}

enum Priority {
  LOW
  MEDIUM
  HIGH
}

enum RiskLevel {
  LOW
  MODERATE
  HIGH
  CRITICAL
}

enum RecommendationType {
  REST_PLAN
  STUDY_PACING
  BREAK_REMINDER
  WELLNESS_TIP
  ACTIVITY_SUGGESTION
}

enum SessionType {
  ACADEMIC
  PERSONAL
  CAREER
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum AchievementType {
  EARLY_BIRD        // First check-in of the day
  NIGHT_OWL         // Late night check-in
  STRESS_WARRIOR    // Low stress maintained
  SLEEP_CHAMPION    // Good sleep streak
  WEEK_WARRIOR      // 7 day streak
  MONTH_MASTER      // 30 day streak
  WELLNESS_GURU     // 100 day streak
  BALANCED_LIFE     // All metrics balanced
  MOOD_BOOSTER      // High mood streak
  ENERGY_STAR       // High energy streak
}

enum ActivityType {
  BREATHING       // Breathing exercises
  MEDITATION      // Meditation session
  STRETCH         // Desk stretches
  WALK            // Short walk
  JOURNALING      // Mood journaling
}

enum SOSStatus {
  ACTIVE
  RESPONDED
  RESOLVED
  CANCELLED
}
